# A7: High-level architecture. Privileges. Web resources specification

## 1. Overview

| Module                                  | Description                                                                                                                                                                                                                                     |
| --------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| M01: Authentication And User Profile    | Web resources associated with user login and logout and the manangement of his/her profile and general search capabilities                                                                                                                       |
| M02: User Administration / Static Pages | Web resources for administrator profile, including user management like giving and taking bans to user and bands, giving warns to users and bands, create, edit and delete genres and skills and manage user permissions                        |
| M03: User Feed                          | Web resources for the main page of the user. This module will have resources to create and delete posts and view posts from users or bands that user follows                                                                                    |
| M04: Bands                              | Web resources for the band profile page. This module will have resources to create and delete band posts, view and modify band information and capabilities of inviting and removing band members as well as accept or reject band applications |
| M05: Chat                               | Web resources for chat functionality, these resources include sending and receiving messages from users and bands                                                                                                                               |
| M06: Comments                           | Web resources for comment of posts                                                                                                                                                                                                              |
| M07: Notifications                      | Web resources for management of notifications                                                                                                                                                                                                   |

## 2. Permissions

| Permission | Name          | Description                                                                      |
| ---------- | ------------- | -------------------------------------------------------------------------------- |
| PUB        | Public        | Priviliges for non-authenticated users                                           |
| USR        | User          | Privileges for authenticated users                                               |
| OWN        | Own User      | Privileges for logged user on user own resources (profile, posts, messages, etc) |
| BOW        | Band Owner    | Privileges for band owners (on the band he/her owns)                             |
| BME        | Band Member   | Privileges for band members (on the band he/her belongs to)                      |
| ADM        | Administrator | Privileges for administrator users                                               |


## 3. Modules

### 3.1 Module M01: Authentication And User Profile

This section documents each web resource of each module, indicating the URL, HTTP methods, the possible parameters, interfaces with the user (referring to the A3 artefact) â€” or JSON responses in the event of APIs.

These are the endpoints available in the Authentication and Individual Profile Module.

    * R100: Home Page /
    * R101: Login Form /login
    * R102: Login Action /do_login
    * R103: Logout Action /do_logout
    * R104: Register Form /register
    * R105: Register Action /do_register
    * R106: View Profile /users/{id}
    * R107: Edit Profile Form /users/{id}/edit
    * R108: Edit Profile Action /users/do_edit
    * R109: Password Request Reset Form /request_password_reset
    * R110: Password Request Reset Action /do_request_password_reset
    * R111: Password Reset Form /users/{id}/reset_password
    * R112: Password Reset Action /users/{id}/do_reset_password



### R100

| R101        | Home Page                                                                                                       |
| ----------- | --------------------------------------------------------------------------------------------------------------- |
| URL         | /                                                                                                               |
| Description | Home page                                                                                                       |
| Method      | GET                                                                                                             |
| UI          | [UI01](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#user-content-ui01-homelogin) |
| PERMISSIONS | PUB                                                                                                             |

### R101

| R101        | Login Form                                                                                                      |
| ----------- | --------------------------------------------------------------------------------------------------------------- |
| URL         | /login                                                                                                          |
| Description | Page with login form                                                                                            |
| Method      | GET                                                                                                             |
| UI          | [UI01](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#user-content-ui01-homelogin) |
| SUBMIT      | [R102](#r102)                                                                                                   |
| PERMISSIONS | PUB                                                                                                             |


### R102

| R102         | Login Action                                                                                         |
| ------------ | ---------------------------------------------------------------------------------------------------- |
| URL          | /do_login                                                                                            |
| Description  | Web resource that logs the user, redirecting to user profile page if successful or login form if not |
| Method       | POST                                                                                                 |
| Request Body | +email:string                                 Username                                               |
|              | +password:string                              Password                                               |
| Redirects    | [R106](#r106)                                   Success                                              |
|              | [R100](#r100)                                   Error                                                |
| Permissions  | PUB                                                                                                  |



### R103

| R103        | Logout Action                                                                  |
| ----------- | ------------------------------------------------------------------------------ |
| URL         | /do_logout                                                                     |
| Description | Web resource that logs out the user                                            |
| Method      | POST                                                                           |
| Redirects   | [R100](#r100)                                                          Success |
| Permissions | USR, ADM                                                                       |


### R104


| R104        | Register Form                                                                                                  |
| ----------- | -------------------------------------------------------------------------------------------------------------- |
| URL         | /register                                                                                                      |
| Description | Page with a register form  to create a new user account                                                        |
| Method      | GET                                                                                                            |
| UI          | [UI04](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#user-content-ui04-register) |
| SUBMIT      | [R105](#r105)                                                                                                  |
| PERMISSIONS | PUB                                                                                                            |


### R105


| R105         | Register Action                                                                                                            |
| ------------ | -------------------------------------------------------------------------------------------------------------------------- |
| URL          | /do_register                                                                                                               |
| Description  | Web resource that inserts the user into the system, redirecting to user profile page if successful or register form if not |
| Method       | POST                                                                                                                       |
| Request Body | +email:string                                 Username                                                                     |
|              | +password:string                              Password                                                                     |
|              | +confirm_password:string                      Password   confirmation                                                      |
|              | +picture:file                                 Profile picture                                                              |
| Redirects    | [R100](#r100)                                   Success                                                                    |
|              | [R104](#r104)                                   Error                                                                      |
| Permissions  | PUB                                                                                                                        |


### R106


| R106        | View Profile                                                                                                  |
| ----------- | ------------------------------------------------------------------------------------------------------------- |
| URL         | /users/{id}                                                                                                   |
| Description | Shows the user individual profile page.                                                                       |
| Method      | GET                                                                                                           |
| Parameters  | +id: integer                                                                                 user primary key |
| UI          | [UI06](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#user-content-ui06-profile) |
| AJAX Calls  | R113, R417                                                                                                    |
| PERMISSIONS | USR                                                                                                           |



### R107


| R107        | Edit Profile Form                                                    |
| ----------- | -------------------------------------------------------------------- |
| URL         | /users/{id}/edit                                                     |
| Description | Page with a form to edit profile info.                               |
| Method      | GET                                                                  |
| Parameters  | +id: integer                                        user primary key |
| UI          | Not yet implemented                                                  |
| SUBMIT      | [R108](#r108)                                                        |
| PERMISSIONS | OWN                                                                  |



### R108


| R108         | Edit Profile Action                                                                                                      |
| ------------ | ------------------------------------------------------------------------------------------------------------------------ |
| URL          | /users/{id}/do_edit                                                                                                      |
| Description  | Web resource that changes user profile info based on the input received. Redirects to the user profile on success and edit profile page on failure. |
| Method       | POST                                                                                                                     |
| Parameteres  | +id: integer                                            user primary key                                                 |
| Request Body | ?name:string                                  New name                                                                   |
|              | ?picture:file                               New profile picture file                                                     |
| Redirects    | [R106](#r106)          Success                                                                                           |
|              | [R107](#r107)          Error                                                                                             |
| Permissions  | OWN                                                                                                                      |




### R109

| R109        | Password Request Reset Form                                  |
| ----------- | ------------------------------------------------------------ |
| URL         | /request_password_reset                                      |
| Description | Page with a form to request an e-mail to reset the password. |
| Method      | GET                                                          |
| UI          | Not implemented yet                                          |
| SUBMIT      | [R110](#r110)                                                |
| PERMISSIONS | OWN                                                          |



### R110


| R110         | Password Request Reset Action                                         |
| ------------ | --------------------------------------------------------------------- |
| URL          | /do_request_password_reset                                            |
| Description  | Web resource that sends a reset password link to the specified email. |
| Method       | POST                                                                  |
| Request Body | +email:string                                User email               |
|              | +username:string                                User name             |
| Redirects    | [R100](#r100)          Success                                        |
|              | [R109](#r109)          Error                                          |
| Permissions  | PUB                                                                   |

### R111


| R111         | Password Reset Form                                        |
| ------------ | ---------------------------------------------------------- |
| URL          | /users/{id}/reset_password                                 |
| Description  | Web resource to specify new password                       |
| Method       | GET                                                        |
| Request Body | +id:integer                                        User id |
| UI           | Not implemented yet                                        |
| SUBMIT       | [R112](#r112)                                              |
| Permissions  | USR                                                        |

### R112


| R110         | Password Reset Action                                                |
| ------------ | -------------------------------------------------------------------- |
| URL          | /users/{id}/do_reset_password                                        |
| Description  | Web resource that changes password of the user                       |
| Method       | POST                                                                 |
| Request Body | +password:string                                new password         |
|              | +confirm:string                                 confirm new password |
| Redirects    | [R100](#r100)          Success                                       |
|              | [R111](#r111)          Error                                         |
| Permissions  | PUB                                                                  |

### R113
| R302          | Get Posts API                                                                     |
| ------------- | --------------------------------------------------------------------------------- |
| URL           | /api/users/{id}/user_posts                                                        |
| Description   | Web resource that searches the system for user posts and returns the results      |
| Method        | GET                                                                               |
| Parameters    | ?offset: integer                                 Offset to retrieve list of posts |
|               | +id: integer                                     User id                          |
| Response Body | [JSON301](#json301)                                                               |
| Permissions   | OWN                                                                               |



### 3.2 Module M02: User Administration / Static Pages


These are the endpoints available in the Authentication and Individual Profile Module.

    * 201: Get users /users
    * 202: Change Privileges user API /admin_api/users/{id}
    * 203: Get reported users /reported_users
    * 204: Ban User API /admin_api/users/{id}/bans
    * 205: Unban User API /admin_api/users/{id}/bans/{banId}
    * 206: Get reported bands /reported_bands
    * 207: Ban Band API /admin_api/bands/{id}/bans
    * 208: Unban Band API /admin_api/bands/{id}/bans/{banId}
    * 209: Get genres /genres
    * 210: Add Genre API /admin_api/genres
    * 211: Edit Genre API /admin_api/genres/{id}
    * 212: Delete Genre API /admin_api/genres{id}
    * 213: Get skills /skills
    * 214: Add Skill API /admin_api/skills
    * 215: Edit Skill API /admin_api/skills/{id}
    * 216: Delete Skill API /admin_api/skills{id}
    * 217: Get User Reports /users/{id}/reports
    * 218: Warn User API: /admin_api/users/{userId}/reports/{reportId}/warns
    * 219: Get Band Reports: /bands/{id}/reports
    * 220: Warn Band API: /admin_api/bands/{bandId}/reports/{reportId}/warns
    * 221: Mark Report as seen API: /admin_api/reports/{id}   
    * 222: About page /about
    * 223: FAQ page /faq
    * 224: Page not found /404

### R201 Get Users
| R201        | Get users                                           |
| ----------- | --------------------------------------------------- |
| URL         | /users                                              |
| Description | Get all users                                       |
| Method      | GET                                                 |
| Parameters  | ?offset: integer - offset to retrieve list of users |
| UI          | UI08                                                |
| AJAX Calls  | R202                                                |
| Permissions | ADM                                                 |

### R202 Change Privileges API
| R202          | Change Privileges API                                                                  |
| ------------- | -------------------------------------------------------------------------------------- |
| URL           | /admin_api/users/{id}                                                                  |
| Description   | Change user permissions, either promoting him to admin or relegating him to basic user |
| Method        | PUT                                                                                    |
| Parameters    | ?id: integer - user id                                                                 |
|               | ?admin: boolean - if it is to promote or relegate user                                 |
| Response body | For http status code different from 200, body  has error message                       |
| Permissions   | ADM                                                                                    |

### R203 Get reported users
| R203        | Get reported users                                           |
| ----------- | ------------------------------------------------------------ |
| URL         | /reported_users                                              |
| Description | Get a list of reported users                                 |
| Method      | GET                                                          |
| Parameters  | ?offset: integer - offset to retrieve list of reported users |
| UI          | UI09                                                         |
| AJAX Calls  | R204,R205                                                    |
| Permissions | ADM                                                          |

### R204 Ban User API
| R204          | Ban User API                                                         |
| ------------- | -------------------------------------------------------------------- |
| URL           | /admin_api/users/{id}/bans                                           |
| Description   | Ban a user                                                           |
| Method        | POST                                                                 |
| Parameters    | ?id: integer - user id                                               |
|               | ?loggedUserId: integer - current logged user to save who banned      |
| Response body | For http status code 200, body has id of ban, else has error message |
| Permissions   | ADM                                                                  |

### R205 Unban User API
| R205          | Unban User API                                                    |
| ------------- | ----------------------------------------------------------------- |
| URL           | /admin_api/users/{id}/bans/{banId}                                |
| Description   | Unban a user                                                      |
| Method        | PUT                                                               |
| Parameters    | ?id: integer - user id                                            |
|               | ?loggedUserId: integer - current logged user to save who unbanned |
|               | ?banId: integer - ban id to put cease date                        |
| Response body | For http status code different from 200, body  has error message  |
| Permissions   | ADM                                                               |


### R206 Get reported bands

| R206        | Get reported bands                                           |
| ----------- | ------------------------------------------------------------ |
| URL         | /reported_bands                                              |
| Description | Get a list of reported bands                                 |
| Method      | GET                                                          |
| Parameters  | ?offset: integer - offset to retrieve list of reported bands |
| UI          | UI09                                                         |
| AJAX Calls  | R206,R027                                                    |
| Permissions | ADM                                                          |

### R207 Ban Band API
| R207          | Ban Band API                                                         |
| ------------- | -------------------------------------------------------------------- |
| URL           | /admin_api/bands/{id}/bans                                           |
| Description   | Ban a band                                                           |
| Method        | POST                                                                 |
| Parameters    | ?id: integer - band id                                               |
|               | ?loggedUserId: integer - current logged user to save who banned      |
| Response body | For http status code 200, body has id of ban, else has error message |
| Permissions   | ADM                                                                  |

### R208 Unban User API
| R208          | Unban Band API                                                    |
| ------------- | ----------------------------------------------------------------- |
| URL           | /admin_api/users/{id}/bans/{banId}                                |
| Description   | Ban or unban a user                                               |
| Method        | PUT                                                               |
| Parameters    | ?id: integer - band id                                            |
|               | ?loggedUserId: integer - current logged user to save who unbanned |
|               | ?banId: integer - ban id to put cease date                        |
| Response body | For http status code different from 200, body  has error message  |
| Permissions   | ADM                                                               |

### R209 Get genres

| R209        | Get genres       |
| ----------- | ---------------- |
| URL         | /genres          |
| Description | Get all genres   |
| Method      | GET              |
| UI          | UI10             |
| AJAX Calls  | R210, R211, R212 |
| Permissions | ADM              |

### R210 Add Genre API

| R210          | Add Genre API                                                          |
| ------------- | ---------------------------------------------------------------------- |
| URL           | /admin_api/genres                                                      |
| Description   | Add a new genre                                                        |
| Method        | POST                                                                   |
| Parameters    | ?name: string - genre name                                             |
|               | ?loggedUserId: integer - current logegd user to save who created       |
| Response body | For http status code 200, body has id of genre, else has error message |
| Permissions   | ADM                                                                    |

### R211 Edit Genre API

| R211          | Edit Genre API                                                    |
| ------------- | ----------------------------------------------------------------- |
| URL           | /admin_api/genres/{id}                                            |
| Description   | Edit a genre                                                      |
| Method        | PUT                                                               |
| Parameters    | ?id: integer - genre id to edit                                   |
|               | ?loggedUserId: integer - current logegd user to save who modified |
| Response body | For http status code different from 200, body  has error message  |
| Permissions   | ADM                                                               |

### R212 Delete Genre API

| R212          | Delete Genre API                                                                                               |
| ------------- | -------------------------------------------------------------------------------------------------------------- |
| URL           | /admin_api/genres/{id}                                                                                         |
| Description   | Delete a genre (actually inactivate it, the field active of json response will come false if genre is deleted) |
| Method        | DELETE                                                                                                         |
| Parameters    | ?id: integer - genre id to delete                                                                              |
|               | ?loggedUserId: integer - current logegd user to save who modified                                              |
| Response body | For http status code different from 200, body  has error message                                               |
| Permissions   | ADM                                                                                                            |

### R213 Get skills

| R213        | Get skills          |
| ----------- | ------------------- |
| URL         | /skills             |
| Description | Get all skills      |
| Method      | GET                 |
| UI          | Not yet Implemented |
| AJAX Calls  | R214, R215, R216    |
| Permissions | ADM                 |

### R214 Add Skill API

| R214          | Add Skill API                                                          |
| ------------- | ---------------------------------------------------------------------- |
| URL           | /admin_api/skills                                                      |
| Description   | Add a new skill                                                        |
| Method        | POST                                                                   |
| Parameters    | ?name: string - skill name                                             |
|               | ?loggedUserId: integer - current logegd user to save who created       |
| Response body | For http status code 200, body has id of genre, else has error message |
| Permissions   | ADM                                                                    |

### R215 Edit Skill API

| R215          | Edit Skill API                                                    |
| ------------- | ----------------------------------------------------------------- |
| URL           | /admin_api/skills/{id}                                            |
| Description   | Edit a skill                                                      |
| Method        | PUT                                                               |
| Parameters    | ?id: integer - skill id to edit                                   |
|               | ?loggedUserId: integer - current logegd user to save who modified |
| Response body | For http status code different from 200, body  has error message  |
| Permissions   | ADM                                                               |

### R216 Delete Skill API

| R216          | Delete Skill API                                                                                               |
| ------------- | -------------------------------------------------------------------------------------------------------------- |
| URL           | /admin_api/skills/{id}                                                                                         |
| Description   | Delete a skill (actually inactivate it, the field active of json response will come false if skill is deleted) |
| Method        | DELETE                                                                                                         |
| Parameters    | ?id: integer - skill id to delete                                                                              |
|               | ?loggedUserId: integer - current logegd user to save who modified                                              |
| Response body | For http status code different from 200, body  has error message                                               |
| Permissions   | ADM                                                                                                            |


### R217 Get User Reports

| R217        | Get User Reports            |
| ----------- | --------------------------- |
| URL         | /users/{id}/reports         |
| Description | Get all reports from a user |
| Method      | GET                         |
| Parameters  | ?id: integer - user id      |
| UI          | Not yet implemented         |
| AJAX Calls  | R218, R221                  |
| Permissions | ADM                         |

### R218 Warn User API

| R218          | Warn User API                                                                   |
| ------------- | ------------------------------------------------------------------------------- |
| URL           | /admin_api/users/{userId}/reports/{reportId}/warns                              |
| Description   | Gives a warning to the user                                                     |
| Method        | POST                                                                            |
| Parameters    | ?userId: integer - user id                                                      |
|               | ?reportId: integer - report id who originates the warn                          |
|               | ?loggedUserId: integer - current logegd user to save as admin who gave the warn |
|               | ?text: string - the text of the warning                                         |
| Response body | For http status code different from 200, body  has error message                |
| Permissions   | ADM                                                                             |


### R219 Get Band Reports

| R219        | Get Band Reports            |
| ----------- | --------------------------- |
| URL         | /bands/{id}/reports         |
| Description | Get all reports from a band |
| Method      | GET                         |
| Parameters  | ?id: integer - band id      |
| UI          | Not yet implemented         |
| AJAX Calls  | R220, R221                  |
| Permissions | ADM                         |

### R220 Warn Band API

| R220          | Warn Band API                                                                   |
| ------------- | ------------------------------------------------------------------------------- |
| URL           | /admin_api/bands/{bandId}/reports/{reportId}/warns                              |
| Description   | Gives a warning to the band                                                     |
| Method        | POST                                                                            |
| Parameters    | ?bandId: integer - band id                                                      |
|               | ?reportId: integer - report id who originates the warn                          |
|               | ?loggedUserId: integer - current logegd user to save as admin who gave the warn |
|               | ?text: string - the text of the warning                                         |
| Response body | For http status code different from 200, body  has error message                |
| Permissions   | ADM                                                                             |


### R221 Mark Report as Seen API

| R221          | Mark Report as Seen API                                          |
| ------------- | ---------------------------------------------------------------- |
| URL           | /admin_api/reports/{id}                                          |
| Description   | Mark the report as seen                                          |
| Method        | PUT                                                              |
| Parameters    | ?id: integer - report id                                         |
| Response body | For http status code different from 200, body  has error message |
| Permissions   | ADM                                                              |

### R222 About Page

| R222        | About Page     |
| ----------- | -------------- |
| URL         | /about         |
| Description | Get about page |
| Method      | GET            |
| UI          | UI02           |
| Permissions | PUB            |

### R223 FAQ Page

| R223        | FAQ Page     |
| ----------- | ------------ |
| URL         | /faq         |
| Description | Get faq page |
| Method      | GET          |
| UI          | UI03         |
| Permissions | PUB          |

### R224 Page not found

| R224        | Page not found      |
| ----------- | ------------------- |
| URL         | /404                |
| Description | Page not found      |
| Method      | GET                 |
| UI          | Not yet implemented |
| Permissions | PUB                 |


## 3.3 M03: User Feed

These are the endpoints available in the User Feed Module.

    * R301: Feed /users/{id}/posts
    * R302: Get Posts API /api/users/{id}/posts
    * R303: Delete Post API /api/users/{userId}/posts/{postId}
    * R304: Create Post /users/{userId}/posts
    * R305: Create Post API /api/users/{userId}/posts
    * R306: Edit Post /users/{userId}/posts
    * R307: Edit Post API /api/users/{userId}/posts{postId}  
    * R308: Get Comments API /api/posts/{postId}/comments
    * R309: Delete Comment API /api/users/{userId}/posts/{postId}/comments{commentId}
    * R310: Create Comment /users/{userId}/posts
    * R311: Create Comment API /api/users/{userId}/posts/{postId}/comments
    * R312: Edit Comment /users/{userId}/posts
    * R313: Edit Comment API /api/users/{userId}/posts/{postId}/comments{commentId}


### R301
| R301        | Feed                                                                                          |
| ----------- | --------------------------------------------------------------------------------------------- |
| URL         | /users/{id}/posts                                                                             |
| Description | Web resource that gets the posts from users and bands the user follows and his own            |
| Method      | GET                                                                                           |
| Parameters  | +id: integer                                                                User id           |
| UI          | [UI05](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#ui05-feed) |
| AJAX Calls  | [R302](#r302), [R303](#r303), [R601](#r601), [R602](#r602)                                    |
| Permissions | OWN                                                                                           |

### R302
| R302          | Get Posts API                                                                     |
| ------------- | --------------------------------------------------------------------------------- |
| URL           | /api/users/{id}/posts                                                             |
| Description   | Web resource that searches the system for posts and returns the results           |
| Method        | GET                                                                               |
| Parameters    | ?offset: integer                                 Offset to retrieve list of posts |
|               | +id: integer                                     User id                          |
| Response Body | [JSON301](#json301)                                                               |
| Permissions   | OWN                                                                               |


### R303
| R303          | Delete Post API                                                  |
| ------------- | ---------------------------------------------------------------- |
| URL           | /api/users/{userId}/posts/{postId}                               |
| Description   | Web resource that checks if the post was well deleted            |
| Method        | DELETE                                                           |
| Parameters    | +postId:integer                                Post id           |
|               | +userId: integer                               User id           |
| Response Body | For http status code different from 200, body  has error message |
| Permissions   | OWN                                                              |

### R304
| R304        | Create Post                                                                                   |
| ----------- | --------------------------------------------------------------------------------------------- |
| URL         | /users/{userId}/posts                                                                         |
| Description | Web resource with a form to create a new post                                                 |
| Method      | GET                                                                                           |
| Parameters  | +userId: integer                                                             User id          |
| UI          | [UI05](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#ui05-feed) |
| AJAX Calls  | [R305](#r305)                                                                                 |
| Permissions | USR                                                                                           |

### R305
| R305          | Create Post API                                                       |
| ------------- | --------------------------------------------------------------------- |
| URL           | /api/users/{userId}/posts                                             |
| Description   | Web resource to create the post                                       |
| Method        | POST                                                                  |
| Parameters    | +text:string                                        Post text         |
|               | +userId: integer                                     User id          |
| Response Body | For http status code 200, body has id of post, else has error message |
| Permissions   | USR                                                                   |

### R306
| R306        | Edit Post                                                                                     |
| ----------- | --------------------------------------------------------------------------------------------- |
| URL         | /users/{userId}/posts                                                                         |
| Description | Web resource with a form to edit a post                                                       |
| Method      | GET                                                                                           |
| Parameters  | +userId: integer                                                             User id          |
| UI          | [UI05](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#ui05-feed) |
| AJAX Calls  | [R307](#r307)                                                                                 |
| Permissions | OWN                                                                                           |

### R307
| R307          | Edit Post API                                                         |
| ------------- | --------------------------------------------------------------------- |
| URL           | /api/users/{userId}/posts{postId}                                     |
| Description   | Web resource to edit a post                                           |
| Method        | PUT                                                                   |
| Parameters    | ?text:string                                        Post text         |
|               | +userId: integer                                     User id          |
|               | +postId: integer                                     Post id          |
| Response Body | For http status code 200, body has id of post, else has error message |
| Permissions   | OWN                                                                   |




## M04: Bands

These are the endpoints available in the Band Module.

    * R401: Band Page                   /bands/{bandID}
    * R402: Get Band Posts API          /api/bands/{id}/posts
    * R403: Delete Band Post API        /bands/{bandID}/posts/{postID}
    * R404: Create Band Post            /bands/{bandId}
    * R405: Create Band Post API        /api/bands/{bandId}/posts
    * R406: Edit Band Post              /bands/{bandId}
    * R407: Edit Band Post API          /api/bands/{bandId}/posts/{postID}
    * R408: Edit Band Profile Form      /bands/{bandID}
    * R409: Edit Band Profile Action    /bands/{bandID}/do_edit_band
    * R410: Invite Band Member          /bands/{bandID}
    * R411: Invite Band Member API      /api/bands/{bandId}/invitations
    * R412: Remove Band Member API      /api/bands/{bandId}/members{memberId}
    * R413: Create New Band Form        /
    * R414: Create New Band Action      /bands/do_create_band
    * R415: Apply to band Form          /bands/{bandId}/apply
    * R416: Apply to band action        /bands/{bandId}/do_apply
    * R417: Manage band application API
                /api/bands/{bandId}/applications/{applicationId}
    * R418: Manage band invitation  API
                /api/bands/{bandId}/invitations/{invitationId}


### R401

| R401        | Band Page                                                                            |
| ----------- | ------------------------------------------------------------------------------------ |
| URL         | /bands/{bandID}                                                                      |
| Description | Band profile page                                                                    |
| Method      | GET                                                                                  |
| Parameters  | +bandId: integer                                                             Band id |
| UI          | UI11                                                                                 |
| AJAX Calls  | [R402](#r402),[R406](#r403) [R601](#r601), [R602](#r602), [R417](#r4017)             |
| PERMISSIONS | USR                                                                                  |

### R402
| R402          | Get Band Posts API                                                                |
| ------------- | --------------------------------------------------------------------------------- |
| URL           | /api/bands/{id}/posts                                                             |
| Description   | Web resource that searches the system for band posts and returns the results      |
| Method        | GET                                                                               |
| Parameters    | ?offset: integer                                 Offset to retrieve list of posts |
|               | +id: integer                                     Band id                          |
| Response Body | [JSON301](#json301)                                                               |
| Permissions   | USR                                                                               |


### R403

| R403          | Delete Band Post API                                             |
| ------------- | ---------------------------------------------------------------- |
| URL           | /bands/{bandID}/posts/{postID}                                   |
| Description   | Web resource that deletes a band post from the system            |
| Method        | DELETE                                                           |
| Parameters    | +postId:integer                         Post Id                  |
| UI            | U11                                                              |
| Response Body | For http status code different from 200, body  has error message |
| Permissions   | BME,OWN                                                          |

### R404
| R404        | Create Band Post                                                                     |
| ----------- | ------------------------------------------------------------------------------------ |
| URL         | /bands/{bandId}                                                                      |
| Description | Web resource with a form to create a new post on behalf of the band                  |
| Method      | GET                                                                                  |
| Parameters  | +bandId: integer                                                             Band id |
| UI          | UI11                                                                                 |
| AJAX Calls  | [R405](#r405)                                                                        |
| Permissions | BME                                                                                  |

### R405
| R405          | Create Band Post API                                                  |
| ------------- | --------------------------------------------------------------------- |
| URL           | /api/bands/{bandId}/posts                                             |
| Description   | Web resource to create the post                                       |
| Method        | POST                                                                  |
| Parameters    | +text:string                                        Post text         |
|               | +userId: integer                                     User id          |
|               | +bandID: integer                                            band id   |
| Response Body | For http status code 200, body has id of post, else has error message |
| Permissions   | BME                                                                   |

### R406
| R406        | Edit Band Post                                                                       |
| ----------- | ------------------------------------------------------------------------------------ |
| URL         | /bands/{bandId}                                                                      |
| Description | Web resource with a form to edit a post on behalf of the band                        |
| Method      | GET                                                                                  |
| Parameters  | +bandId: integer                                                             Band id |
| UI          | UI11                                                                                 |
| AJAX Calls  | [R407](#r407)                                                                        |
| Permissions | BME,OWN                                                                              |

### R407
| R407          | Edit Band Post API                                                    |
| ------------- | --------------------------------------------------------------------- |
| URL           | /api/bands/{bandId}/posts/{postID}                                    |
| Description   | Web resource to delete apost                                          |
| Method        | PUT                                                                   |
| Parameters    | +text:string                                        Post text         |
|               | +postId:integer                         Post Id                       |
| Response Body | For http status code 200, body has id of post, else has error message |
| Permissions   | BME,OWN                                                               |


### R408

| R408        | Edit Band Profile Form                                          |
| ----------- | --------------------------------------------------------------- |
| URL         | /bands/{bandID}                                                 |
| Description | Page with a form to edit band profile info.                     |
| Method      | GET                                                             |
| Parameters  | +bandID: integer                                        band id |
| UI          | UI11                                                            |
| SUBMIT      | [R409](#r409)                                                   |
| PERMISSIONS | BOW                                                             |


### R409


| R409         | Edit Band Profile Action                                                 |
| ------------ | ------------------------------------------------------------------------ |
| URL          | /bands/{bandID}/do_edit_band                                             |
| Description  | Web resource that changes band profile info based on the input received. |
| Method       | POST                                                                     |
| Parameteres  | +bandID: integer                                            band id      |
| Request Body | ?name:string                                  New name                   |
|              | ?picture:file                               Band profile picture         |
| Redirects    | [R404](#r404)          Success                                           |
|              | [R405](#r405)          Error                                             |
| Permissions  | BOW                                                                      |


### R410


| R410         | Invite Band Member                                           |
| ------------ | ------------------------------------------------------------ |
| URL          | /bands/{bandID}                                              |
| Description  | Web resource with a form to search for a user to add to band |
| Method       | GET                                                          |
| Request Body | +bandId:integer                                 Band ID      |
| AJAX Calls   | [R411](#r411)                                                |
| Permissions  | BOW                                                          |


### R411
| R411          | Invite Band Member  API                                                     |
| ------------- | --------------------------------------------------------------------------- |
| URL           | /api/bands/{bandId}/invitations                                             |
| Description   | Web resource to add a member to the band                                    |
| Method        | POST                                                                        |
| Parameters    | +text:string                                        invitation text         |
|               | +userId:integer                         id of invited user                  |
|               | +bandID: integer                                            band id         |
| Response Body | For http status code 200, body has id of user added, else has error message |
| Permissions   | BOW                                                                         |

### R412
| R412          | Remove Band Member  API                                             |
| ------------- | ------------------------------------------------------------------- |
| URL           | /api/bands/{bandId}/members{memberId}                               |
| Description   | Web resource to add a member to the band                            |
| Method        | DELETE                                                              |
| Parameters    | +text:string                                        removal text    |
|               | +memberId:integer                         id of removed user        |
|               | +bandID: integer                                            band id |
| Response Body | For http status code different from 200, body  has error message    |
| Permissions   | BOW                                                                 |

### R413

| R413        | Create New Band Form                 |
| ----------- | ------------------------------------ |
| URL         | /                                    |
| Description | Page with a form to create new band. |
| Method      | GET                                  |
| UI          | Not yet implemented                  |
| SUBMIT      | [R414](#r414)                        |
| PERMISSIONS | USR                                  |


### R414


| R414         | Create New Band Action                                                   |
| ------------ | ------------------------------------------------------------------------ |
| URL          | /bands/do_create_band                                                    |
| Description  | Web resource that changes band profile info based on the input received. |
| Method       | POST                                                                     |
| Request Body | ?name:string                                  New name                   |
|              | ?picture:file                               Band profile picture         |
| Redirects    | [R401](#r401)          Success                                           |
|              | [R100](#r100)          Error                                             |
| Permissions  | USR                                                                      |

### R415

| R415        | Apply to band Form                     |
| ----------- | -------------------------------------- |
| URL         | /bands/{bandId}/apply                  |
| Description | Page with a form to apply to a band.   |
| Method      | GET                                    |
| Parameters  | bandId: integer                band id |
| UI          | Not yet implemented                    |
| SUBMIT      | [R416](#r416)                          |
| PERMISSIONS | USR                                    |


### R416


| R416         | Apply to band action                                     |
| ------------ | -------------------------------------------------------- |
| URL          | /bands/{bandId}/do_apply                                 |
| Description  | Web resource that creates a band application             |
| Method       | POST                                                     |
| Parameters   | bandId: integer                band id                   |
| Request Body | ?id:integer                                 User id      |
|              | ?text: string                               Brief resume |
| Redirects    | [R401](#r401)          Success                           |
|              | [R401](#r401)          Error                             |
| Permissions  | USR                                                      |



### R417
| R417          | Manage band application  API                                                                    |
| ------------- | ----------------------------------------------------------------------------------------------- |
| URL           | /api/bands/{bandId}/applications/{applicationId}                                                |
| Description   | Web resource to accept, reject or cancel band application                                       |
| Method        | PUT                                                                                             |
| Parameters    | +text:string                                                reply text                          |
|               | +applicationId:integer                                      applicationId                       |
|               | +bandID: integer                                            band id                             |
|               | +new_state: {accepted, rejected, cancelled}                            new state of application |
| Response Body | For http status code different from 200, body  has error message                                |
| Permissions   | BOW (accept or reject), USR (cancel)                                                            |


### R418
| R418          | Manage band invitation  API                                                                     |
| ------------- | ----------------------------------------------------------------------------------------------- |
| URL           | /api/bands/{bandId}/invitations/{invitationId}                                                  |
| Description   | Web resource to accept, reject or cancel band invitation                                        |
| Method        | PUT                                                                                             |
| Parameters    | +text:string                                                reply text                          |
|               | +invitationId:integer                                      invitation id                        |
|               | +bandID: integer                                            band id                             |
|               | +new_state: {accepted, rejected, cancelled}                            new state of application |
| Response Body | For http status code different from 200, body  has error message                                |
| Permissions   | BOW (cancel), USR (accept or reject)                                                            |



## M05: Chat

These are the endpoints available in the Chat Module.

    * R501: Chat /users/{userId}/chat
    * R502: Get Friend Messages API /api/users/{userId}/friends/{friendId}/messages
    * R503: Send Friend Message /users/{userId}/chat
    * R504: Send Friend Message API /api/users/{userId}/friends/{friendId}/messages    
    * R505: Get Band Messages API /users/{userId}/chat  
    * R506: Send Band Message /api/users/{userId}/bands/{bandId}/messages
    * R507: Send Band Message API /api/users/{userId}/bands/{bandId}/messages

### R501    
| R501        | Chat                                                                                          |
| ----------- | --------------------------------------------------------------------------------------------- |
| URL         | /users/{userId}/chat                                                                          |
| Description | Web resource of the chat                                                                      |
| Method      | GET                                                                                           |
| Parameters  | +userId:integer                                                                   userId      |
| UI          | [UI05](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#ui05-feed) |
| AJAX Calls  | [R502](#r502), [R505](#r505)                                                                  |
| Permissions | USR                                                                                           |

### R502
| R502          | Get Friend Messages API                                                    |
| ------------- | -------------------------------------------------------------------------- |
| URL           | /api/users/{userId}/friends/{friendId}/messages                            |
| Description   | Web resource that searches the system for messages and returns the results |
| Method        | GET                                                                        |
| Parameters    | +userId:integer                                                  user Id   |
|               | +friendId:integer                                            friend Id     |
|               | ?offset: integer                       Offset to retrieve list of messages |
| Response Body | [JSON501](#json501)                                                        |
| Permissions   | USR                                                                        |

### R503
| R503        | Send Friend Message                                                                           |
| ----------- | --------------------------------------------------------------------------------------------- |
| URL         | /users/{userId}/chat                                                                          |
| Description | Web resource with a form to create a message                                                  |
| Method      | GET                                                                                           |
| Parameters  | +userId:integer                                                                   userId      |
| UI          | [UI05](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#ui05-feed) |
| AJAX Calls  | [R504](#r504)                                                                                 |
| Permissions | USR                                                                                           |

### R504
| R504          | Send Friend Messages API                                                   |
| ------------- | -------------------------------------------------------------------------- |
| URL           | /api/users/{userId}/friends/{friendId}/messages                            |
| Description   | Web resource that searches the system for messages and returns the results |
| Method        | POST                                                                       |
| Parameters    | +userId:integer                                                  user Id   |
|               | +friendId:integer                                            friend Id     |
| Response Body | For http status code different from 200, body  has error message           |
| Permissions   | USR                                                                        |

### R505
| R505          | Get Band Messages API                                                      |
| ------------- | -------------------------------------------------------------------------- |
| URL           | /api/users/{userId}/bands/{bandId}/messages                                |
| Description   | Web resource that searches the system for messages and returns the results |
| Method        | GET                                                                        |
| Parameters    | +userId:integer                                                  user Id   |
|               | +bandId:integer                                            band Id         |
|               | ?offset: integer                       Offset to retrieve list of messages |
| Response Body | [JSON501](#json501)                                                        |
| Permissions   | USR                                                                        |

### R506
| R506        | Send Band Message                                                                             |
| ----------- | --------------------------------------------------------------------------------------------- |
| URL         | /users/{userId}/chat                                                                          |
| Description | Web resource with a form to create a message                                                  |
| Method      | GET                                                                                           |
| Parameters  | +userId:integer                                                                   userId      |
| UI          | [UI05](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#ui05-feed) |
| AJAX Calls  | [R508](#r507)                                                                                 |
| Permissions | USR                                                                                           |

### R507
| R507          | Send Band Messages API                                                     |
| ------------- | -------------------------------------------------------------------------- |
| URL           | /api/users/{userId}/bands/{bandId}/messages                                |
| Description   | Web resource that searches the system for messages and returns the results |
| Method        | POST                                                                       |
| Parameters    | +userId:integer                                                  user Id   |
|               | +bandId:integer                                            band Id         |
| Response Body | For http status code different from 200, body  has error message           |
| Permissions   | USR                                                                        |



## M06: Comments

These are the endpoints available in the Chat Module.

    * R601: Get Comments API /api/posts/{postId}/comments
    * R602: Delete Comment API  /api/posts/{postId}/comments/{commentId}
    * R603: Create Comment /users/{userId}/posts,
            /bands/{bandId} and
            /users/{userId}/posts
    * R604: Create Comment API  /api/posts/{postId}/comments  
    * R605: Edit Comment /users/{userId}/posts,
            /bands/{bandId} and
            /users/{userId}/posts
    * R606: Edit Comment API  /api/posts/{postId}/comments/{commentId}

### R601
| R601          | Get Comments API                                                                             |
| ------------- | -------------------------------------------------------------------------------------------- |
| URL           | /api/posts/{postId}/comments                                                                 |
| Description   | Web resource that searches the system for comments and returns the results                   |
| Method        | GET                                                                                          |
| Parameters    | +postId:integer                                          Post id                             |
|               | ?offset: integer                                         Offset to retrieve list of comments |
| Response Body | [JSON601](#json601)                                                                          |
| Permissions   | USR                                                                                          |


### R602
| R602          | Delete Comment API                                               |
| ------------- | ---------------------------------------------------------------- |
| URL           | /api/posts/{postId}/comments{commentId}                          |
| Description   | Web resource to delete a comment                                 |
| Method        | DELETE                                                           |
| Parameters    | +postId:integer                        Post id                   |
|               | +commentId:integer            Comment primary key                |
| Response Body | For http status code different from 200, body  has error message |
| Permissions   | OWN                                                              |

### R603
| R603        | Create Comment                                                                                |
| ----------- | --------------------------------------------------------------------------------------------- |
| URL         | /users/{userId}/posts, /bands/{bandId} and /users/{userId}/posts                              |
| Description | Web resource with a form to create a new comment on a post                                    |
| Method      | GET                                                                                           |
| UI          | [UI05](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#ui05-feed) |
| AJAX Calls  | [R311](#r311)                                                                                 |
| Permissions | USR                                                                                           |

### R604
| R604          | Create Comment API                                                       |
| ------------- | ------------------------------------------------------------------------ |
| URL           | /api/posts/{postId}/comments                                             |
| Description   | Web resource to create a comment                                         |
| Method        | POST                                                                     |
| Parameters    | +userId:integer                           user id                        |
|               | +postId:integer                          post id                         |
|               | ?text:string                      comment text                           |
| Response Body | For http status code 200, body has id of comment, else has error message |
| Permissions   | USR                                                                      |

### R605
| R605        | Edit Comment                                                                                  |
| ----------- | --------------------------------------------------------------------------------------------- |
| URL         | /users/{userId}/posts, /bands/{bandId} and /users/{userId}/posts                              |
| Description | Web resource with a form to edit a comment on a post                                          |
| Method      | GET                                                                                           |
| Paramenters | +userId: integer                                                             User id          |
| UI          | [UI05](https://github.com/joaopedrofump/lbaw1712/wiki/A3:-User-Interface-Prototype#ui05-feed) |
| AJAX Calls  | [R313](#r313)                                                                                 |
| Permissions | OWN                                                                                           |

### R606
| R606          | Edit Comment API                                                 |
| ------------- | ---------------------------------------------------------------- |
| URL           | /api/posts/{postId}/comments{commentId}                          |
| Description   | Web resource to create a comment                                 |
| Method        | PUT                                                              |
| Paramenters   | +postId: integer                          post id                |
|               | +commentId: integer                       comment id             |
|               | ?text:string                              comment text           |
| Response Body | For http status code different from 200, body  has error message |
| Permissions   | OWN                                                              |


## M07: User Notifications

These are the endpoints available in the User Notifications Module.

    * R701: Get Notifications /
    * R702: Get Notifications API /api/users/{userId}/notifications

### R701    
| R701        | Get Notifications                        |
| ----------- | ---------------------------------------- |
| URL         | /                                        |
| Description | Web resource that gets the notifications |
| Method      | GET                                      |
| AJAX Calls  | [R702](#r702)                            |
| Permissions | USR                                      |

### R702
| R702          | Get Notifications API                                                           |
| ------------- | ------------------------------------------------------------------------------- |
| URL           | /api/users/{userId}/notifications                                               |
| Description   | Web resource that searches the system for notifications and returns the results |
| Method        | GET                                                                             |
| Response Body | [JSON701](#json701)                                                             |
| Permissions   | USR                                                                             |

### 4.JSON/XML Types

### JSON301 (Posts array)
```json
 [
        {
            "id": "1",
            "date":"01/04/2018 17:21:08",
            "text": "sdfsfdsgdfgdh",
            "author": {
                "id": 34,
                "name": "JoÃ£o Pedro"
            },
            "bandName":"Pearl Jam",
            "bandId":3
        },

        {
            "id": "3",
            "date":"31/03/2018 18:31:01",
            "text": "sdfsfsdfsdgdfgfdgdsgdfgdh",
            "author": {
                "id": 22,
                "name": "Danny"
            },
            "bandName":null,
            "bandId":null
        },

        {
            "id": "6",
            "date":"31/03/2018 17:31:21",
            "text": "sdfsfssdfsdgsfdfsdgdfgfdgdsgdfgdh",
            "author": {
                "id": 12,
                "name": "JoÃ£o Conde"
            },
            "bandName":"Future Islands",
            "bandId":6
        }
]

```



### JSON501
```json
[
    {
        "id": "1",
        "text": "Hello",
        "date":"31/03/2018 17:31:21",
        "author": {
            "id": 34,
            "name": "JoÃ£o Pedro"
        }
    },

    {
        "id": "2",
        "text": "How are you?",
        "date":"31/03/2018 17:32:11",
        "author": {
            "id": 22,
            "name": "Danny"
        }
    }

]
```



### JSON601
```json
[
        {
            "id": "1",
            "text": "Very nice post",
            "author": {
                "id": 34,
                "name": "JoÃ£o Pedro"
            }
        },

        {
            "id": "3",
            "text": "Thanks JoÃ£o",
            "author": {
                "id": 22,
                "name": "Danny"
            }
        },

        {
            "id": "6",
            "text": "Which JoÃ£o?",
            "author": {
                "id": 12,
                "name": "JoÃ£o Conde"
            }
        }
]

```


### JSON701
```json
[
    {
        "id": "1",
        "date":"01/04/2018 17:21:08",
        "text": "Danny Soares followed you",
        "link": "/users/12"
    },

    {
        "id": "2",
        "date":"01/04/2018 17:21:08",
        "text": "Nice post",
        "link": "/posts/16/comments/18"
    }

]


```


## Revision history

- Added Modules
- Changed paths to be RESTful compliant
- JSON reviews
- Added HTTP error codes in some AJAX call responses
- Added permissions 


***

GROUP1712, 11/04/2018

> JoÃ£o Pinheiro, up201104913@fe.up.pt

> Leonardo Teixeira, up201502848@fe.up.pt

> Danny Soares, up201505509@fe.up.pt

> JoÃ£o Azevedo, up201503256@fe.up.pt
