# A5: Relational Schema, validation and schema refinement

## 1. Relational Schema

Relation schemas are specified in the compact notation:

|Identifier|Relation|
| -------- | --------- |
|R01      |user(<u>id</u>, username **NN** **UK**, password **NN**, name **NN**, bio, dateOfBirth **CK** dateOfBirth < Today, birthLocation, deactivationDate **DF** NULL, warns **DF** 0, location → City **NN**, rating **IN** RatingLevel )|
|R02      |admin(<u>id</u>, userId → user)|
|R03      |band(<u>id</u>, name **NN** **UK**, creationDate, ceaseDate, location → City **NN**)|
|R04      |content(<u>id</u>, text **NN**, date **DF** Today)|
|R05      |post(<u>id</u>, private **NN**, contentId → content **NN**, posterId → musician **NN**, bandId → band)|
|R06      |message(<u>id</u>, contentId → content **NN**, senderId → musician **NN**, receiverId → musician, bandId → band )|
|R07      |comment(<u>id</u>, contentId → content **NN**, commenterId → musician **NN**, postId → post **NN**)|
|R08      |country(<u>id</u>, name **NN** **UK**)|
|R09      |city(<u>id</u>, name **NN**, countryId → Country)|
|R10      |genre(<u>id</u>, name **NN**,  creatingAdminId → admin)|
|R11      |skill(<u>id</u>, name **NN**,  creatingAdminId → admin)|
|R12      |report(<u>id</u>, text **NN**,  date **DF** Today, reportedContentId → content, reportedUserId → user, reportedBandId → band, reporterId → user)|
|R13      |ban(<u>id</u>, reason **NN**,  banDate **DF** Today, ceaseDate **DF** Today adminId → admin)|
|R14      |notification_trigger(<u>id</u>,  date **DF** Today, type **IN** NotificationTypes, originUserFollower → user_follower, originBandFollower → band_follower, originMessage → message, originComment → comment, originBandApplication → Application, originBandInvitation → band_invitation, originUserWarning → user_warning, originBandWarning → band_warning, type **IN** NotificationTypes)|
|R15      |user_skill(<u>userId → user, skillId → skill</u> , level **IN** SkillLevels)|
|R16      |user_follower(<u>id</u>, (followingUserId → user, followedUserId → user) **UK**)|
|R17      |user_rating(<u>ratingUserId → user, ratedUserId → user</u>, rating **IN** RatingLevel)|
|R18      |user_genre(<u>userId → user, genreId → genre</u>)|
|R19      |user_warning(<u>id</u>, (adminId → admin, userId → user) **UK** **NN**)|
|R20      |band_genre(<u>bandId → band, genreId → genre</u>)|
|R21      |band_membership(<u>bandId → band, userId → user</u>, isOwner **NN**, initialDate, ceaseDate)|
|R22      |band_rating(<u>ratedBandId → band, ratingUserId → userId</u>, rating **IN** RatingLevel)|
|R23      |band_warning(<u>id</u>, (adminId → admin, bandId → band) **UK** **NN**)|
|R24      |band_follower(<u>id</u>, (userId → user, bandId → band) **UK** **NN**)|
|R25      |band_application(<u>id</u>, (userId → user, bandId → band) **UK** **NN**, date **DF** Today, lastStatusDate, status **IN** ApplicationStatus) |
|R26      |band_invitation(<u>id</u>, (userId → user, bandId → band) **UK** **NN**, date **DF** Today, lastStatusDate, status **IN** InvitationStatus) |
|R27      |user_notification(<u>notificationTriggerId → notification_trigger, userId → user </u>, seen)|



where UK means UNIQUE KEY, NN means NOT NULL, DF means DEFAULT and CK means CHECK.

## 2. Domains

| Domain Name           | Domain Specification                                                                         |
| --------------------- | -------------------------------------------------------------------------------------------- |
| Today	                | DATE DEFAULT CURRENT_DATE                                                                    |
| RatingLevel           | {1,2,3,4,5}                                                                                  |
| SkillLevels           | {1,2,3,4,5}                                                                                  |
| ApplicationStatus     | ENUM('Accepted', 'Pending', 'Rejected', 'Cancelled')                                         |
| NotificationTypes     | ENUM('Warning, 'Post', 'Comment', 'Follow', 'Band', 'Invitation', 'Application', 'Message')  |
| InvitationStatus      | ENUM('Accepted', 'Pending', 'Rejected', 'Cancelled')                                         |


## 3. Functional Dependencies  and schema validation

To validate the Relational Schema obtained from the Conceptual Model, all functional dependencies are identified and the normalization of all relation schemas is accomplished.


| **Table R01** (user)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id, username }                                                                                                    ||
| **Functional Dependencies**                                                                                                   ||
| FD0101          | {id} → {username, password, name, bio, dateOfBirth, birthLocation, deactivationDate, warns, location, rating}|
| FD0102          | {username} → {id, password, name, bio, dateOfBirth, birthLocation, deactivationDate, warns, location, rating}|
| **Normal Form** | BCNF                                                                                                         |

| **Table R02** (admin)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD0201          | {id} → {userId}                                                                                              |    
| **Normal Form** | BCNF                                                                                                         |

| **Table R03** (band)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id, name }                                                                                                        ||
| **Functional Dependencies**                                                                                                   ||
| FD0301          | {id} → {name, creationDate, ceaseDate, location}                                                             |
| FD0302          | {name} → {id, creationDate, ceaseDate, location}                                                             |
| **Normal Form** | BCNF                                                                                                         |

| **Table R04** (content)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD0401          | {id} → {text, date}                                                                                          |
| **Normal Form** | BCNF                                                                                                         |

| **Table R05** (post)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD0501          | {id} → {private, contentId, posterId, bandId}                                                                |
| **Normal Form** | BCNF                                                                                                         |

| **Table R06** (message)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD0601          | {id} → {contentId, senderId, receiverId, bandId}                                                             |
| **Normal Form** | BCNF                                                                                                         |

| **Table R07** (comment)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD0701          | {id} → {contentId, commenterId, postId}                                                                      |
| **Normal Form** | BCNF                                                                                                         |

| **Table R08** (country)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id, name }                                                                                                        ||
| **Functional Dependencies**                                                                                                   ||
| FD0801          | {id} → {name}                                                                                                |
| FD0802          | {name} → {id}                                                                                                |
| **Normal Form** | BCNF                                                                                                         |

| **Table R09** (city)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD0901          | {id} → {name, countryId}                                                                                     |
| **Normal Form** | BCNF                                                                                                         |

| **Table R10** (genre)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD1001          | {id} → {name, creatingAdminId}                                                                               |
| **Normal Form** | BCNF                                                                                                         |

| **Table R11** (skill)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD1101          | {id} → {name, creatingAdminId}                                                                               |
| **Normal Form** | BCNF                                                                                                         |

| **Table R12** (report)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD1201          | {id} → {text, date, reportedContentId, reportedUserId, reportedBandId, reporterId}                           |
| **Normal Form** | BCNF                                                                                                         |

| **Table R13** (ban)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD1301          | {id} → {reason, banDate, ceaseDate, adminId}                                                                 |
| **Normal Form** | BCNF                                                                                                         |

| **Table R14** (notification_trigger)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id }                                                                                                              ||
| **Functional Dependencies**                                                                                                   ||
| FD1401          | {id} → {date, type, originUserFollower, originBandFollower, originMessage, originComment, originBandApplication, originBandInvitation, originUserWarning, originBandWarning}                                                                                            |
| **Normal Form** | BCNF                                                                                                         |

| **Table R15** (user_skill)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { {userId,skillId } }                                                                                               ||
| **Functional Dependencies**                                                                                                   ||
| FD1501          | {userId, skillId} → {level}                                                                                  |
| **Normal Form** | BCNF                                                                                                         |

| **Table R16** (user_follower)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id, (followingUserId, followedUserId) }                                                                           ||
| **Functional Dependencies**                                                                                                   ||
| FD1601          | {id} → {followingUserId, followedUserId}                                                                     |
| FD1601          | {followingUserId, followedUserId} → {id}                                                                     |
| **Normal Form** | BCNF                                                                                                         |

| **Table R17** (user_rating)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { {ratingUserId, ratedUserId} }                                                                                     ||
| **Functional Dependencies**                                                                                                   ||
| FD1701          | {ratingUserId, ratedUserId} → {rating}                                                                       |
| **Normal Form** | BCNF                                                                                                         |

| **Table R18** (user_genre)                                                                                                    ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { userId, genreId }                                                                                                 ||
| **Functional Dependencies**                                                                                                   ||
| (none)                                                                                                                        ||
| **Normal Form** | BCNF                                                                                                         |

| **Table R19** (user_warning)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id, (adminId, userId) }                                                                                           ||
| **Functional Dependencies**                                                                                                   ||
| FD1901          | {id} → {adminId, userId}                                                                                     |
| FD1901          | {adminId, userId} → {id}                                                                                     |
| **Normal Form** | BCNF                                                                                                         |

| **Table R20** (band_genre)                                                                                                    ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { {bandId, genreId} }                                                                                               ||
| **Functional Dependencies**                                                                                                   ||
| (none)                                                                                                                        ||
| **Normal Form** | BCNF                                                                                                         |

| **Table R21** (band_membership)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { {bandId, userId} }                                                                                                ||
| **Functional Dependencies**                                                                                                   ||
| FD2101          | {bandId, userId} → {isOwner, initialDate, ceaseDate}                                                         |
| **Normal Form** | BCNF                                                                                                         |

| **Table R22** (band_rating)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { {ratedBandId, ratingUserId} }                                                                                     ||
| **Functional Dependencies**                                                                                                   ||
| FD2201          | {ratedBandId, ratingUserId} → {rating}                                                                       |
| **Normal Form** | BCNF                                                                                                         |

| **Table R23** (band_warning)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id, (adminId, bandId) }                                                                                           ||
| **Functional Dependencies**                                                                                                   ||
| FD2301          | {id} → {adminId, bandId}                                                                                     |
| FD2301          | {adminId, bandId} → {id}                                                                                     |
| **Normal Form** | BCNF                                                                                                         |

| **Table R24** (band_follower)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id, (followingUserId, followedBandId) }                                                                           ||
| **Functional Dependencies**                                                                                                   ||
| FD2401          | {id} → {followingUserId, followedBandId}                                                                     |
| FD2401          | {followingUserId, followedBandId} → {id}                                                                     |
| **Normal Form** | BCNF                                                                                                         |

| **Table R25** (band_application)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id, (userId, bandId) }                                                                                            ||
| **Functional Dependencies**                                                                                                   ||
| FD2501          | {id} → {userId, bandId, date, lastStatusDate, status}                                                        |
| FD2501          | {userId, bandId} → {id, date, lastStatusDate, status}                                                        |
| **Normal Form** | BCNF                                                                                                         |

| **Table R26** (band_invitation)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { id, (userId, bandId) }                                                                                            ||
| **Functional Dependencies**                                                                                                   ||
| FD2601          | {id} → {bandId, userId, date, lastStatusDate, status}                                                        |
| FD2602          | {bandId, userId} → {id, date, lastStatusDate, status}                                                        |
| **Normal Form** | BCNF                                                                                                         |

| **Table R27** (user_notification)                                                                                                                 ||
| ----------------------------------------------------------------------------------------------------------------------------- ||
| **Keys**: { (notificationTriggerId, userId) }                                                                                 ||
| **Functional Dependencies**                                                                                                   ||
| FD2701          | {notificationTriggerId, userId} → {seen}                                                                     |
| **Normal Form** | BCNF                                                                                                         |

AS all relations schemas are in the Boyce–Codd Normal Form (BCNF), the relational schema is also in the BCNF and therefore there is no need to be refined using normalisation.
