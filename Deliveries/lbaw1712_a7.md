# A7: High-level architecture. Privileges. Web resources specification
 
## 1. Overview
 
| Module                                     | Description                                                                                                                                                                                                                                     |
| ------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| M01: Authentication And Indiviudal Profile | Web resources associated with user login and logout and the manangement of his/her profile and managemento of notifications and general serch capabilities                                                                                      |
| M02: User Administration / Static Pages    | Web resources for administrator profile, including user management like giving and taking bans to user and bands, giving warns to users and bands, create, edit and delete genres and skills and manage user permissions                        |
| M03 User Feed                              | Web resources for the main page of the user. This module will have resources to create and delete posts and view posts from users or bands that user follows                                                                                    |
| M04 Bands                                  | Web resources for the band profile page. This module will have resources to create and delete band posts, view and modify band information and capabilities of inviting and removing band members as well as accept or reject band applications |
| M05 Chat                                   | Web resources for chat functionality, these resources include sending and receiving messages from users and bands                                                                                                                               |

## 2. Permissions

| Permission | Name          | Description                                          |
| ---------- | ------------- | ---------------------------------------------------- |
| PUB        | Public        | Priviliges for non-authenticated users               |
| USR        | User          | Privileges for authenticated users                   |
| BOW        | Band Owner    | Privileges for band owners (on the band he/her owns) |
| ADM        | Administrator | Privileges for administrator users                   |


## 3. Modules

This section documents each web resource of each module, indicating the URL, HTTP methods, the possible parameters, interfaces with the user (referring to the A3 artefact) â€” or JSON responses in the event of APIs.
Module M01: Authentication and Individual Profile
Endpoints of Module Authentication and Individual Profile

### 3.1 Module M01: Authentication And Indiviudal Profile

These are the endpoints available in the Authentication and Individual Profile Module.

    * R101: Login Form /login
    * R102: Login Action /login
    * R103: Login Google API /api/google
    * R104: Login Facebook API /api/facebook
    * R105: Logout Action /logout
    * R106: Register Form /register
    * R107: Register Action /register
    * R108: View Profile /users/{userID}
    * R109: Edit Profile Form /users/{userID}/edit
    * R110: Edit Profile Action /users/{userID}
    * R111: Password Reset Form /password/reset
    * R112: Password Reset Action /password/reset


R101: Login Form


|             |                                                                                            |
| ----------- | ------------------------------------------------------------------------------------------ |
| URL         | /login                                                                                     |
| Description | Page with login form                                                                       |
| Method      | GET                                                                                        |
| UI          | [UI01](https://github.com/joaopedrofump/lbaw1712/blob/master/Deliveries/lbaw1712_a3-2.pdf) |
| SUBMIT      | [R102](https://pages.github.com/)                                                          |
| PERMISSIONS | PUB                                                                                        |


R102: Login Action

|              |                                                                                                      |
| ------------ | ---------------------------------------------------------------------------------------------------- |
| URL          | /login                                                                                               |
| Description  | Web resource that logs the user, redirecting to user profile page if successful or login form if not |
| Method       | POST                                                                                                 |
| Request Body | +email:string                                                                                        | Username |
|              | +password:string                                                                                     | Password |
| Redirects    | [R108](https://pages.github.com/)                                                                    | Success |
|              | [R101](https://pages.github.com/)                                                                    | Error |
| Permissions  | PUB                                                                                                  |


R103: Login Google API /api/google

R104: Login Facebook API /api/facebook

R105: Logout Action /logout

|             |                                     |
| ----------- | ----------------------------------- |
| URL         | /logout                             |
| Description | Web resource that logs out the user |
| Method      | POST                                |
| Redirects   | [R101](https://pages.github.com/)   | Success |
| Permissions | USR, ADM                            |



R106: Register Form /register


|             |                                                                                            |
| ----------- | ------------------------------------------------------------------------------------------ |
| URL         | /register                                                                                  |
| Description | Page with a register form  to create a new user account                                    |
| Method      | GET                                                                                        |
| UI          | [UI04](https://github.com/joaopedrofump/lbaw1712/blob/master/Deliveries/lbaw1712_a3-2.pdf) |
| SUBMIT      | [R107](https://pages.github.com/)                                                          |
| PERMISSIONS | PUB                                                                                        |



R107: Register Action /register


|              |                                                                                                                            |
| ------------ | -------------------------------------------------------------------------------------------------------------------------- |
| URL          | /register                                                                                                                  |
| Description  | Web resource that inserts the user into the system, redirecting to user profile page if successful or register form if not |
| Method       | POST                                                                                                                       |
| Request Body | +email:string                                                                                                              | Username |
|              | +password:string                                                                                                           | Password |
|              | +confirm_password:string                                                                                                   | Password   confirmation |
|              | +picture:string                                                                                                            | Profile picture path |

|  Redirects    |   [R101](https://pages.github.com/)       |   Success                                                 |
|               |   [R107](https://pages.github.com/)       |   Error                                                   |
|  Permissions  |  PUB                                                                                                  |



### 3.2 Module M02: User Administration / Static Pages


These are the endpoints available in the Authentication and Individual Profile Module.

    * 201: Get users /users
    * 202: Change Privileges user API /admin_api/users/{id}/edit_privileges

    * 203: Get reported users /reported_users
    * 204: Ban/Unban User API /admin_api/users/{id}/ban_unban_user

    * 205: Get reported bands /reported_bands
    * 206: Ban/Unban Band API /admin_api/bands/{id}/ban_unban_band

    * 207: Get genres /genres
    * 208: Add Genre API /admin_api/genres/add_genre
    * 209: Edit Genre API /admin_api/genres/{id}/edit_genre
    * 210: Delete Genre API /admin_api/genres{id}/delete_genre


    * 211: Get skills /skills
    * 212: Add Genre API /admin_api/skills/add_skill
    * 213: Edit Genre API /admin_api/skills/{id}/edit_skill
    * 214: Delete Genre API /admin_api/skills{id}/delete_skill

    * 215: Get User Reports /users/{id}/reports
    * 216: Warn User API: /admin_api/users/{id}/reports/{id}/warn
    
    * 217: Get Band Reports: /bands/{id}/reports
    * 218: Warn Band API: /admin_api/bands/{id}/reports/{id}/warn

    * 219: Mark Report as seen API: /admin_api/users/{id}/reports/{id}/seen
    
    * 220: About page /about
    * 221: FAQ page /faq


**R220** About Page

| URL | /about |
| Description | Get about page |
| Method | GET |
| UI | UI02 |
| Permissions | PUB |

**R221** FAQ Page

| URL | /faq |
| Description | Get faq page |
| Method | GET |
| UI | UI03 |
| Permissions | PUB |




**R215** Get User Reports

| URL | /users/{id}/reports |
| Description | Get all reports from a user |
| Method | GET |
| Parameters | ?id: integer - user id |
| UI | Not yet implemented |
| AJAX Calls | R216, R219 |
| Permissions | ADM |

**R216** Warn User API

| URL | /admin_api/users/{id}/reports/{id}/warn |
| Description | Gives a warning to the user |
| Method | POST |
| Parameters | ?userId: integer - user id |
|           | ?reportId: integer - report id who originates the warn |
|           | ?loggedUserId: integer - current logegd user to save as admin who gave the warn |
|           | ?text: string - the text of the warning |
| Response body | JSON 306 |
| Permissions | ADM |


**R217** Get Band Reports

| URL | /bands/{id}/reports |
| Description | Get all reports from a band |
| Method | GET |
| Parameters | ?id: integer - band id |
| Not yet implemented |
| AJAX Calls | R218, R219 |
| Permissions | ADM |

**R218** Warn Band API

| URL | /admin_api/bands/{id}/reports/{id}/warn |
| Description | Gives a warning to the band |
| Method | POST |
| Parameters | ?bandId: integer - band id |
|           | ?reportId: integer - report id who originates the warn |
|           | ?loggedUserId: integer - current logegd user to save as admin who gave the warn |
|           | ?text: string - the text of the warning |
| Response body | JSON 306 |
| Permissions | ADM |


**R219** Mark Report as Seen API

| URL | /admin_api/users/{id}/reports/{id}/seen |
| Description | Mark the report as seen |
| Method | PUT |
| Parameters | ?reportId: integer - report id |
| Response body | JSON 306 |
| Permissions | ADM |



**R201** Get Users

| URL | /users |
| Description | Get all users |
| Method | GET |
| UI |UI08 |
| AJAX Calls | R202 |
| Permissions | ADM |

**R202** Change Privileges API

| URL | /admin_api/users/{id}/edit_privileges |
| Description | Change user permissions, either promoting him to admin or relegating him to basic user |
| Method | PUT |
| Parameters | ?id: integer - user id |
|           | ?admin: boolean - if it is to promote or relegate user |
| Response body | JSON 301 |
| Permissions | ADM |

**R203** Get reported users

| URL | /reported_users |
| Description | Get a list of reported users |
| UI |UI09 |
| AJAX Calls | R204 |
| Permissions | ADM |

**R204** Ban/Unban User API

| URL | /admin_api/users/{id}/ban_unban_user |
| Description | Ban or unban a user |
| Parameters | ?userId: integer - user id |
|           | ?loggedUserId: integer - current logegd user to save who banned |
|           | ?ban: boolean - if it is to ban or unban user |
| Response body | JSON 302 |
| Permissions | ADM |


**R205** Get reported bands

| URL | /reported_bands |
| Description | Get a list of reported bands |
| UI |UI09 |
| AJAX Calls | R206 |
| Permissions | ADM |

**R206** Ban/Unban Band API

| URL | /admin_api/users/{id}/ban_unban_user |
| Description | Ban or unban a user |
| Parameters | ?bandId: integer - band id |
|           | ?loggedUserId: integer - current logegd user to save who banned |
|           | ?ban: boolean - if it is to ban or unban user |
| Response body | JSON 303 |
| Permissions | ADM |

**R207** Get genres

| URL | /genres |
| Description | Get all genres |
| Method | GET |
| UI |UI10 |
| AJAX Calls | R208, R209, R210 |
| Permissions | ADM |

**R208** Add Genre API

| URL | /admin_api/genres/add_genre |
| Description | Add a new genre |
| Method | POST |
| Parameters | ?name: string - genre name |
|           | ?loggedUserId: integer - current logegd user to save who created |
| Response body | JSON 304 |
| Permissions | ADM |

**R209** Edit Genre API

| URL | /admin_api/genres/{id}/edit_genre |
| Description | Edit a genre |
| Method | PUT |
| Parameters | ?id: integer - genre id to edit |
|           | ?loggedUserId: integer - current logegd user to save who modified |
| Response body | JSON 304 |
| Permissions | ADM |

**R210** Delete Genre API

| URL | /admin_api/genres/{id}/delete_genre |
| Description | Delete a genre (actually inactivate it, the field active of json response will come false if genre is deleted)|
| Method | DELETE |
| Parameters | ?id: integer - genre id to delete |
|           | ?loggedUserId: integer - current logegd user to save who modified |
| Response body | JSON 304 |
| Permissions | ADM |

**R211** Get skills

| URL | /skills |
| Description | Get all skills |
| Method | GET |
| Not yet Implemented |
| AJAX Calls | R212, R213, R214 |
| Permissions | ADM |

**R212** Add Skill API

| URL | /admin_api/skills/add_skill |
| Description | Add a new skill |
| Method | POST |
| Parameters | ?name: string - skill name |
|           | ?loggedUserId: integer - current logegd user to save who created |
| Response body | JSON 305 |
| Permissions | ADM |

**R213** Edit Skill API

| URL | /admin_api/skills/{id}/edit_skill |
| Description | Edit a skill |
| Method | PUT |
| Parameters | ?id: integer - skill id to edit |
|           | ?loggedUserId: integer - current logegd user to save who modified |
| Response body | JSON 305 |
| Permissions | ADM |

**R214** Delete Skill API

| URL | /admin_api/skills/{id}/delete_skill |
| Description | Delete a skill (actually inactivate it, the field active of json response will come false if skill is deleted) |
| Method | DELETE |
| Parameters | ?id: integer - skill id to delete |
|           | ?loggedUserId: integer - current logegd user to save who modified |
| Response body | JSON 305 |
| Permissions | ADM |





### 4.JSON/XML Types

JSON 301: {user_privilege}

```json

{
    "id": 3,
    "admin" : true
    
}


```

JSON 302: {user_is_banned}

```json

{
    "id": 5,
    "banned" : true
    
}


```

JSON 303: {band_is_banned}

```json

{
    "id": 1,
    "banned" : true
    
}


```

JSON 304: {genre}

```json

{
    "id": 19,
    "name" : "rock",
    "creatingAdmin": 1,
    "isActive":true
    
}


```

JSON 305: {skill}

```json

{
    "id": 21,
    "name" : "drums",
    "creatingAdmin": 1,
    "isActive":true
    
}


```


JSON 306: {warn/read}

```json

{
    "success": true,
    
}


```
